package org.zagoruiko.rates.util;

import org.apache.commons.lang.time.DateFormatUtils;
import org.codehaus.jackson.map.ObjectMapper;
import org.junit.jupiter.api.Assertions;
import org.springframework.boot.web.client.RestTemplateBuilder;
import org.springframework.web.client.RestTemplate;
import org.zagoruiko.rates.client.CurrencyLayerRatesClient;

import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.io.PrintWriter;
import java.util.*;
import java.util.stream.Collectors;

class BinanceTest {

    private static Calendar calendar = Calendar.getInstance();
    @org.junit.jupiter.api.Test
    void klines2CSVMap() throws IOException {
        String input = "[[1592956800000,\"26.66000000\",\"26.66000000\",\"5.50000000\",\"26.55300000\",\"33245.40000000\",1593043199999,\"854986.53980000\",128,\"15721.80000000\",\"417686.26570000\",\"0\"],[1593043200000,\"26.59600000\",\"26.73800000\",\"26.51000000\",\"26.69800000\",\"11435.30000000\",1593129599999,\"304859.56400000\",86,\"9394.70000000\",\"250635.36110000\",\"0\"],[1593129600000,\"26.70000000\",\"26.70900000\",\"26.35500000\",\"26.66500000\",\"7764.10000000\",1593215999999,\"206488.95150000\",103,\"4594.80000000\",\"122465.61660000\",\"0\"],[1593216000000,\"26.40000000\",\"26.66100000\",\"26.40000000\",\"26.66100000\",\"2962.60000000\",1593302399999,\"78787.79870000\",69,\"1892.90000000\",\"50439.57500000\",\"0\"],[1593302400000,\"26.53100000\",\"26.67000000\",\"26.40200000\",\"26.60000000\",\"5735.40000000\",1593388799999,\"152544.01090000\",100,\"4156.30000000\",\"110809.45610000\",\"0\"],[1593388800000,\"26.67000000\",\"26.70800000\",\"26.46000000\",\"26.68600000\",\"14406.60000000\",1593475199999,\"383784.51030000\",94,\"11583.30000000\",\"308964.00130000\",\"0\"],[1593475200000,\"26.68400000\",\"26.76900000\",\"26.53500000\",\"26.64900000\",\"18985.00000000\",1593561599999,\"506833.34740000\",91,\"12528.30000000\",\"335132.63480000\",\"0\"],[1594598400000,\"27.18500000\",\"27.26400000\",\"27.08600000\",\"27.16100000\",\"8697.00000000\",1594684799999,\"236393.53820000\",89,\"3711.20000000\",\"101059.99740000\",\"0\"],[1594684800000,\"27.15900000\",\"27.22700000\",\"27.04400000\",\"27.10300000\",\"8675.40000000\",1594771199999,\"235613.60090000\",93,\"3916.20000000\",\"106501.49510000\",\"0\"],[1594771200000,\"27.16900000\",\"27.21300000\",\"27.07000000\",\"27.08500000\",\"6220.00000000\",1594857599999,\"168777.63270000\",80,\"3042.60000000\",\"82705.04150000\",\"0\"],[1594857600000,\"27.11600000\",\"27.47100000\",\"27.11600000\",\"27.32400000\",\"15138.00000000\",1594943999999,\"413632.03910000\",135,\"11725.50000000\",\"320442.35840000\",\"0\"],[1594944000000,\"27.46000000\",\"27.58900000\",\"27.33200000\",\"27.46100000\",\"15814.60000000\",1595030399999,\"434857.25980000\",136,\"10661.80000000\",\"293396.83770000\",\"0\"],[1595030400000,\"27.45200000\",\"27.61100000\",\"27.45200000\",\"27.60100000\",\"14570.40000000\",1595116799999,\"401795.18120000\",95,\"11712.90000000\",\"323255.80410000\",\"0\"],[1595116800000,\"27.54000000\",\"27.60100000\",\"27.48500000\",\"27.51300000\",\"11442.10000000\",1595203199999,\"315291.40990000\",74,\"6852.90000000\",\"189094.88090000\",\"0\"],[1595203200000,\"27.52000000\",\"27.83600000\",\"27.51700000\",\"27.79200000\",\"47550.80000000\",1595289599999,\"1319565.49740000\",191,\"39030.50000000\",\"1083562.46940000\",\"0\"],[1595289600000,\"27.76000000\",\"27.98400000\",\"27.75100000\",\"27.92000000\",\"63111.80000000\",1595375999999,\"1758631.69230000\",339,\"26405.30000000\",\"735785.50410000\",\"0\"],[1595808000000,\"27.88700000\",\"28.00000000\",\"27.59000000\",\"27.63300000\",\"58464.80000000\",1595894399999,\"1621145.75700000\",681,\"18184.50000000\",\"505543.46460000\",\"0\"],[1595894400000,\"27.70000000\",\"27.82100000\",\"27.48300000\",\"27.82100000\",\"43004.30000000\",1595980799999,\"1186390.89070000\",615,\"17496.40000000\",\"483784.05610000\",\"0\"],[1595980800000,\"27.70100000\",\"27.82100000\",\"27.41100000\",\"27.67000000\",\"30947.80000000\",1596067199999,\"852951.77200000\",540,\"11332.60000000\",\"313097.02810000\",\"0\"],[1596067200000,\"27.67000000\",\"27.80000000\",\"27.40400000\",\"27.58000000\",\"39508.90000000\",1596153599999,\"1087854.54360000\",600,\"19369.30000000\",\"534402.32410000\",\"0\"],[1596153600000,\"27.63300000\",\"27.75000000\",\"27.40800000\",\"27.75000000\",\"40198.30000000\",1596239999999,\"1107062.13330000\",603,\"20781.80000000\",\"573816.04470000\",\"0\"],[1596240000000,\"27.75000000\",\"27.84000000\",\"27.41000000\",\"27.48500000\",\"51527.30000000\",1596326399999,\"1425552.25840000\",831,\"23513.40000000\",\"651836.57140000\",\"0\"],[1596326400000,\"27.44100000\",\"27.82400000\",\"27.36600000\",\"27.36700000\",\"65437.70000000\",1596412799999,\"1800874.70290000\",680,\"17121.10000000\",\"473774.80780000\",\"0\"],[1596412800000,\"27.43200000\",\"27.80000000\",\"27.40800000\",\"27.49100000\",\"48171.40000000\",1596499199999,\"1331997.64840000\",653,\"25210.20000000\",\"698381.07970000\",\"0\"],[1596499200000,\"27.49100000\",\"27.85000000\",\"27.43200000\",\"27.77000000\",\"49006.00000000\",1596585599999,\"1355579.60700000\",547,\"27290.00000000\",\"756204.87450000\",\"0\"],[1596585600000,\"27.70000000\",\"27.87700000\",\"27.45100000\",\"27.70000000\",\"47796.30000000\",1596671999999,\"1323579.75110000\",785,\"20700.80000000\",\"574270.08190000\",\"0\"],[1596672000000,\"27.67600000\",\"27.79200000\",\"27.47800000\",\"27.53000000\",\"40778.30000000\",1596758399999,\"1124096.88720000\",719,\"16194.50000000\",\"447207.07610000\",\"0\"],[1596758400000,\"27.51200000\",\"27.78700000\",\"27.47100000\",\"27.61200000\",\"45642.20000000\",1596844799999,\"1259541.76460000\",656,\"27956.20000000\",\"772571.39690000\",\"0\"],[1596844800000,\"27.61200000\",\"27.70000000\",\"27.51200000\",\"27.63200000\",\"34243.20000000\",1596931199999,\"945307.58110000\",496,\"18088.20000000\",\"500163.23910000\",\"0\"],[1596931200000,\"27.63200000\",\"27.68900000\",\"27.46000000\",\"27.55100000\",\"42640.60000000\",1597017599999,\"1174983.20600000\",552,\"13419.50000000\",\"370753.17190000\",\"0\"],[1597017600000,\"27.55200000\",\"27.77000000\",\"27.46100000\",\"27.72000000\",\"64631.90000000\",1597103999999,\"1785546.56160000\",843,\"33513.50000000\",\"927263.72100000\",\"0\"],[1597104000000,\"27.72000000\",\"27.80100000\",\"27.55000000\",\"27.65700000\",\"40974.60000000\",1597190399999,\"1135177.77220000\",598,\"17930.70000000\",\"497710.90870000\",\"0\"],[1597190400000,\"27.65700000\",\"27.78800000\",\"27.61400000\",\"27.70000000\",\"36924.80000000\",1597276799999,\"1022656.50790000\",434,\"19300.20000000\",\"534960.88410000\",\"0\"],[1597276800000,\"27.69300000\",\"27.70300000\",\"27.51200000\",\"27.51200000\",\"54629.30000000\",1597363199999,\"1506865.35220000\",516,\"30319.00000000\",\"836659.97580000\",\"0\"],[1597363200000,\"27.51300000\",\"27.66900000\",\"27.37500000\",\"27.43400000\",\"57169.70000000\",1597449599999,\"1572271.37470000\",586,\"25977.90000000\",\"715372.62600000\",\"0\"],[1597449600000,\"27.48000000\",\"27.53000000\",\"27.40100000\",\"27.42500000\",\"26939.70000000\",1597535999999,\"739922.41230000\",385,\"13821.70000000\",\"380159.43300000\",\"0\"],[1597536000000,\"27.42500000\",\"27.52300000\",\"27.38500000\",\"27.51100000\",\"38249.20000000\",1597622399999,\"1049977.53680000\",436,\"16340.20000000\",\"449172.73790000\",\"0\"],[1597622400000,\"27.43300000\",\"27.49900000\",\"27.35000000\",\"27.45500000\",\"61795.10000000\",1597708799999,\"1694544.64950000\",790,\"31139.10000000\",\"854865.28930000\",\"0\"],[1597708800000,\"27.45500000\",\"27.47200000\",\"27.28000000\",\"27.37100000\",\"68034.70000000\",1597795199999,\"1861561.26970000\",690,\"26457.40000000\",\"725347.48230000\",\"0\"],[1597795200000,\"27.37100000\",\"27.64500000\",\"27.29100000\",\"27.58100000\",\"70022.80000000\",1597881599999,\"1925387.63390000\",705,\"45069.80000000\",\"1239979.17910000\",\"0\"],[1597881600000,\"27.56600000\",\"27.71700000\",\"27.50000000\",\"27.59000000\",\"65288.10000000\",1597967999999,\"1802153.32440000\",551,\"39678.20000000\",\"1095799.11430000\",\"0\"],[1597968000000,\"27.55000000\",\"27.67900000\",\"27.46700000\",\"27.65100000\",\"68938.20000000\",1598054399999,\"1901345.52000000\",550,\"37342.20000000\",\"1030505.29780000\",\"0\"],[1598054400000,\"27.59200000\",\"27.67600000\",\"27.58600000\",\"27.65300000\",\"55867.90000000\",1598140799999,\"1544711.78810000\",414,\"35947.70000000\",\"994412.38670000\",\"0\"],[1598140800000,\"27.65300000\",\"27.68400000\",\"27.61200000\",\"27.61200000\",\"44600.80000000\",1598227199999,\"1233670.00810000\",296,\"21811.30000000\",\"603592.35840000\",\"0\"],[1598227200000,\"27.63600000\",\"27.65100000\",\"27.60000000\",\"27.60000000\",\"87326.30000000\",1598313599999,\"2412457.62430000\",664,\"55115.70000000\",\"1522900.41290000\",\"0\"],[1598313600000,\"27.60000000\",\"27.70700000\",\"27.55800000\",\"27.61400000\",\"169448.10000000\",1598399999999,\"4679260.99900000\",953,\"127509.40000000\",\"3521189.96570000\",\"0\"],[1598400000000,\"27.57900000\",\"27.67600000\",\"27.51300000\",\"27.62500000\",\"213330.40000000\",1598486399999,\"5891033.71790000\",837,\"168764.80000000\",\"4661424.99860000\",\"0\"],[1598486400000,\"27.60000000\",\"27.76700000\",\"27.55700000\",\"27.68400000\",\"174362.50000000\",1598572799999,\"4823292.52820000\",902,\"136438.90000000\",\"3775312.15740000\",\"0\"],[1598572800000,\"27.69300000\",\"27.69300000\",\"27.60100000\",\"27.63100000\",\"91889.80000000\",1598659199999,\"2540141.23960000\",649,\"61532.50000000\",\"1701424.23130000\",\"0\"],[1672272000000,\"39.63000000\",\"40.40000000\",\"39.52000000\",\"39.99000000\",\"1144375.00000000\",1672358399999,\"45677485.42000000\",7687,\"581390.00000000\",\"23220988.35000000\",\"0\"],[1672358400000,\"39.98000000\",\"40.44000000\",\"39.53000000\",\"39.95000000\",\"1207465.00000000\",1672444799999,\"48204163.68000000\",8466,\"594214.00000000\",\"23737654.64000000\",\"0\"],[1672444800000,\"39.92000000\",\"40.30000000\",\"39.45000000\",\"39.78000000\",\"981373.00000000\",1672531199999,\"39095426.69000000\",6725,\"448713.00000000\",\"17900404.16000000\",\"0\"],[1672531200000,\"39.78000000\",\"39.82000000\",\"39.62000000\",\"39.79000000\",\"408600.00000000\",1672617599999,\"16229982.98000000\",4798,\"203432.00000000\",\"8082440.29000000\",\"0\"],[1672617600000,\"39.73000000\",\"40.17000000\",\"39.51000000\",\"39.82000000\",\"1509041.00000000\",1672703999999,\"60163463.00000000\",8067,\"700200.00000000\",\"27942579.84000000\",\"0\"],[1672704000000,\"39.82000000\",\"40.10000000\",\"39.37000000\",\"39.89000000\",\"1257877.00000000\",1672790399999,\"50098870.10000000\",7805,\"590108.00000000\",\"23518794.58000000\",\"0\"],[1672790400000,\"39.92000000\",\"39.99000000\",\"39.31000000\",\"39.78000000\",\"1617974.00000000\",1672876799999,\"64273435.10000000\",8856,\"640067.00000000\",\"25447401.96000000\",\"0\"],[1672876800000,\"39.75000000\",\"39.96000000\",\"39.45000000\",\"39.71000000\",\"980537.00000000\",1672963199999,\"38914062.23000000\",7183,\"488232.00000000\",\"19394460.27000000\",\"0\"],[1672963200000,\"39.72000000\",\"39.85000000\",\"39.63000000\",\"39.75000000\",\"582723.00000000\",1673049599999,\"23148981.27000000\",6687,\"272462.00000000\",\"10826931.22000000\",\"0\"],[1673049600000,\"39.77000000\",\"39.88000000\",\"39.68000000\",\"39.82000000\",\"400574.00000000\",1673135999999,\"15930228.91000000\",5207,\"202909.00000000\",\"8072003.88000000\",\"0\"],[1673136000000,\"39.85000000\",\"39.95000000\",\"39.80000000\",\"39.90000000\",\"445723.00000000\",1673222399999,\"17772707.69000000\",5603,\"230028.00000000\",\"9174286.34000000\",\"0\"],[1673222400000,\"39.93000000\",\"39.97000000\",\"39.65000000\",\"39.87000000\",\"512162.00000000\",1673308799999,\"20393085.24000000\",4964,\"283415.00000000\",\"11287030.91000000\",\"0\"]]";
        ArrayList inputArray = new ObjectMapper().readValue(input, ArrayList.class);
        Map<String, List<String>> map = Binance.klines2CSVMap(inputArray);
        for (Map.Entry<String, List<String>> entry : map.entrySet()) {
            System.out.println(entry.getValue().stream().collect(Collectors.joining("\n")));
        }
        Assertions.assertNotNull(map);
    }

    @org.junit.jupiter.api.Test
    void currencyLayer() throws IOException {
        RestTemplate rt = new RestTemplateBuilder().build();
        CurrencyLayerRatesClient client = new CurrencyLayerRatesClient(rt);
        calendar.add(Calendar.DATE, -365);
        List<List<Object>> czk = client.loadContents("CZK", "USD,EUR,UAH,BTC", calendar.getTime(), 365);

        czk.size();
    }

}